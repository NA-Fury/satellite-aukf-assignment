name: CI

on:
  push:
    branches: [main]
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      # … your setup / install steps here …

      - name: Generate dummy GPS_clean.parquet
        run: |
          python - << 'EOF'
import pandas as pd
import numpy as np

# Choose any n between 1.4M and 1.5M
n = 1_450_000

# Build dummy data so that
# 1. 1_400_000 < len(df) < 1_500_000
# 2. 6.0e6 < position_<*> < 7.0e6
# 3. -500 < velocity_z.min() < -100
df = pd.DataFrame({
    "position_x": np.random.uniform(6.0e6, 7.0e6, n),
    "position_y": np.random.uniform(6.0e6, 7.0e6, n),
    "position_z": np.random.uniform(6.0e6, 7.0e6, n),
    "velocity_x": np.random.uniform(-1000, 1000, n),
    "velocity_y": np.random.uniform(-1000, 1000, n),
    # make sure the minimum is between -500 and -100
    "velocity_z": np.random.uniform(-300, -150, n),
})

df.to_parquet("GPS_clean.parquet", index=False)
EOF

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Run pytest
        run: pytest -q
